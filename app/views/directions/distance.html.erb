<!-- <article class="article-distance"> -->
  <div class="col-md-6" id="right-panel">
    <p>Todos os caminhos são feitos atráves de rotas de estradas</p>
    <div id="output"></div>
  </div>
  <div class="col-md-6" id="map"></div>
<!-- </article> -->

<script>
  function initMap() {
    var bounds = new google.maps.LatLngBounds;
    var markersArray = [];
    var map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: -5.748535, lng: -35.357119},
      zoom: 10
    });
    var geocoder = new google.maps.Geocoder;
    var service = new google.maps.DistanceMatrixService;

    service.getDistanceMatrix({
      origins: hashJS(gon.places),
      destinations: hashJS(gon.places),
      travelMode: 'DRIVING',
      unitSystem: google.maps.UnitSystem.METRIC,
      avoidHighways: false,
      avoidTolls: false
    }, function(response, status) {
      if (status !== 'OK') {
        alert('Error was: ' + status);
      } else {
        var outputDiv = document.getElementById('output');
        outputDiv.innerHTML = '';
        deleteMarkers(markersArray);

        var showGeocodedAddressOnMap = function() {
          return function(results, status) {
            if (status === 'OK') {
              map.fitBounds(bounds.extend(results[0].geometry.location));
              markersArray.push(new google.maps.Marker({
                map: map,
                position: results[0].geometry.location
              }));
            } else {
              alert('Geocode was not successful due to: ' + status);
            }
          };
        };
        createTable(response, geocoder, showGeocodedAddressOnMap, outputDiv);
      }
    });
  }

  function createTable(response, geocoder, showGeocodedAddressOnMap, outputDiv){
    var tbl  = document.createElement('table');

        tbl.style.border = '1px solid black';
    var initials_lenght = gon.initials.length;
    for(var i = 0; i < initials_lenght+1; i++){
      if (i < initials_lenght) {
        geocoder.geocode({'address': response.originAddresses[i]}, showGeocodedAddressOnMap());
      }
      // console.log(JSON.stringify(response, null, 1));
      var tr = tbl.insertRow();
      for(var j = 0; j < initials_lenght+1; j++){
        var td = tr.insertCell();
        var value = '';
        if ((i === 0) && (j === 0))
          value = '';
        else if (i === 0)
          value = gon.initials[j-1];
        else if (j === 0)
          value = gon.initials[i-1];
        else {
          if ((i <= initials_lenght) && (j <= initials_lenght)) {
            value = response.rows[i-1].elements[j-1].duration.text + ' à ' + response.rows[i-1].elements[j-1].distance.text;
          }
        }

        td.appendChild(document.createTextNode(value));
        td.style.padding = '10px';
        td.style.border = '1px solid black';
      }
    }
    outputDiv.appendChild(tbl);
  }

  function hashJS(array) {
    result = []

    for(var i=0; i < array.length; ++i)
      result.push({ lat: array[i][0], lng: array[i][1] })

    return result
  }

  function deleteMarkers(markersArray) {
    for (var i = 0; i < markersArray.length; i++) {
      markersArray[i].setMap(null);
    }
    markersArray = [];
  }
</script>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAVz4E_4pKqtMrerILua81D7zGYS26Iod8&callback=initMap"></script>
